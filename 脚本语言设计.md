# 脚本语言设计

## 功能选择

+ 投诉建议
+ 技术帮助
+ 修改密码
+ 查询账户信息
+ 充值
+ 登录
+ 注册

## 变量定义

```c++
define Variable:
    @money@ double -"金额" default 0.0
    @content@ text -"内容" default ""
    @name@ text -"用户名" default ""
    @time@ object -"时间"
```

## 脚本语法结构

### 脚本结构

```assembly
behavior_module + default_module?
```

### 行为模块

```assembly
define behavior_module:
	do behavior_name {
		behavior*;
	}
```

### 默认处理模块

```assembly
define default_module:
	do default {
		default*;
	}
```

## 关键字

```assembly
define keyword:
	do ---> 触发行为
	call ---> 调用函数
	set ---> 设置变量
	if ---> 条件判断
	else ---> 条件分支
	response ---> 机器人回应
	speak ---> 机器人说话
	jump ---> 跳转行为
	exit ---> 退出
	default ---> 默认
	运算符保持与C++语言一致
	{} ---> 行为块边界
	() ---> 表达式边界
	"" ---> 字符串边界
	空格 ---> 词法分隔符
	; ---> 语法分隔符
	缩进 ---> 父子模块边界
```

## 语句格式

### 变量设置语句

```assembly
set variable_name = expression 

expression -> @velue@ || call function_name
```

###  条件语句

```assembly
if (expression) {
	behavior*;
}
else  {
    if (expression) {
        behavior*;
    }
    else{
        behavior*;
    }
}
```

### 跳转语句

```assembly
jump behavior_name;
```

###  函数调用语句

```assembly
call function_name;
```

## 用户语法

### 阻塞

```assembly
do choke {
	set userInput = @content@;
	if (userInput == "登录") {
		jump login;
	}
	else {
		if (userInput == "注册") {
			jump register;
		}
		else {
			if (userInput == "退出") {
				jump exit;
			}
		}
	}
	set is_login = call isLogin;
	if (is_login) {
		call AI_Interface;
	}
	else {
		speak "您尚未登录，输入登录以进入登录功能...输入注册以进入注册功能...";
		jump choke;
	}
}
```

### 开始语句

```assembly
do begin {
	speak "您好！我是奶小龙！我有什么可以帮助您的？";
	speak "可以尝试输入充值或投诉等使用功能......(Y^_^Y)";
	speak "输入登录/注册以登录/注册AvA";
	jump choke;
}
```

### 退出

```assembly
do exit {
	call EX;
}
```

### 登录

```assembly
do login {
	speak "登录";
	speak "请输入您的用户名:";
	set userName = @content@;
	speak "请输入您的密码:";
	set passWord = @content@;
	set accessLogin = call Login;
	if (accessLogin) {
		speak "登录成功!";
		jump ask;
	}
	else {
		jump choke;
	}
}
```

### 注册

```assembly
do register {
	speak "注册";
	speak "请输入您的用户名:";
	set subUserName = @content@;
	speak "请输入您的密码:";
	set subPassWord = @content@;
	speak "请确认您的密码:";
	set subPassWord2 = @content@;
	set accessRegister = call Register;
	if (accessRegister) {
		speak "注册成功!";
		jump choke;
	}
	else {
		jump choke;
	}
}
```

### 默认

```assembly
do default {
	speak "相关功能暂未开发哦~";
	jump ask;
} 
```

### 询问语句

```assembly
do ask {
	speak "亲~还有什么我可以帮助您的？";
	jump choke;
}
```

### 投诉建议

```assembly
do complaint_or_suggest {
	speak "亲，请向我们阐述您详细的投诉诉求~";
    set complaint = @content@;
    speak "亲，我们非常理解您的心情，我们已经收到您的投诉，您对我们有什么建议吗？";
    set advice = @content@;
    call writeCA;
    speak "您的投诉与建议我们已经收到了~";
    jump ask;
}
```

### 使用帮助

```assembly
do help {
	speak "可选功能如下:";
	speak "投诉建议";
    speak "使用帮助";
    speak "修改密码";
    speak "查询账户信息";
    speak "充值";
    speak "登录";
    speak "注册";
	jump ask;
}
```

### 功能查询

```assembly
do help {
	speak "可选功能如下:";
	speak "投诉建议";
    speak "使用帮助";
    speak "修改密码";
    speak "查询账户信息";
    speak "充值";
    speak "登录";
    speak "注册";
	jump ask;
}
```

### 修改密码

```assembly
do change_password {
	set original_password = call getOriginalPassword;
	speak "请输入原密码：";
	set original_password_input = @content@;
	if (original_password_input == original_password) {
		jump input_new_password;
	}
	else {
		speak "你输入的原密码错误，请重新输入";
		jump change_password;
	}
}
```

### 输入新密码

```assembly
do input_new_password {
	speak "请输入您的新密码：";
	set new_password = @content@;
	set password_judge = call judgePassword;
	if (password_judge) {
		jump confirm_password;
	}
	else {
		speak "新密码不能与原密码相同...";
		jump input_new_password;
	}
}
```

### 确认密码

```assembly
do confirm_password {
	speak "请确认您的密码：";
	set confirm_password = @content@;
	if (confirm_password == new_password) {
		speak "修改密码成功！";
		jump ask;
	}
	else {
		speak "您两次输入的密码不同，请重新输入";
           jump input_new_password;
	}
}
```

### 查询账户信息

```assembly
do query_account {
	set output = call getUserInformation;
	speak "正在获取您的账号信息，请稍等...";
	call printUserInformation;
	jump ask;
}
```

### 充值

```assembly
do recharge {
	speak "请输入您想要充值的金额:";
	set recharge_money = @money@;
	set recharge_success = call Recharge;
	if (recharge_success) {
		speak "充值成功，当前余额:";
		call printRemain;
		jump ask;
	}
	else {
		speak "充值失败，请稍后重试...请检查金额小数点后最多只有两位";
		jump ask;
	}
}
```

