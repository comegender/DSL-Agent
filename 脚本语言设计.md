# 脚本语言设计

## 功能选择

+ 投诉建议
+ 技术帮助
+ 修改密码
+ 查询账户信息
+ 充值

## 变量定义

```c++
define Variable:
    @money@ double -"金额" default 0.0
    @content@ text -"内容" default ""
    @name@ text -"用户名" default ""
    @time@ object -"时间"
```

## 脚本语法结构

### 脚本结构

```assembly
behavior_module + default_module?
```

### 行为模块

```assembly
define behavior_module:
	do behavior_name {
		behavior*;
	}
```

### 默认处理模块

```assembly
define default_module:
	do default {
		default*;
	}
```

## 关键字

```assembly
define keyword:
	do ---> 触发行为
	call ---> 调用函数
	set ---> 设置变量
	if ---> 条件判断
	else ---> 条件分支
	response ---> 机器人回应
	speak ---> 机器人说话
	jump ---> 跳转行为
	exit ---> 退出
	default ---> 默认
	运算符保持与C++语言一致
	{} ---> 行为块边界
	() ---> 表达式边界
	"" ---> 字符串边界
	空格 ---> 词法分隔符
	; ---> 语法分隔符
	缩进 ---> 父子模块边界
```

## 语句格式

### 变量设置语句

```assembly
set variable_name = expression 

expression -> @velue@ || call function_name
```

###  条件语句

```assembly
if (expression) {
	behavior*;
}
else  {
    if (expression) {
        behavior*;
    }
    else{
        behavior*;
    }
}
```

### 跳转语句

```assembly
jump behavior_name;
```

###  函数调用语句

```assembly
call function_name;
```

### 退出

```assembly
exit;
```



## 用户语法

### 阻塞

```assembly
do choke {
	call clock;
	call getUserInput;
	call AI_Interface;
	if (@time@ > 60) {
		speak "您已经很久没有操作了哦~系统将在30s后退出";
	}
	if (@time@ > 90) {
		call exit;
	}
}
```

### 开始语句

```assembly
do begin {
	speak "您好！我是奶小龙！我有什么可以帮助您的？</br>可以尝试输入充值或投诉等使用功能......(Y^_^Y)<br/>输入 退出 以结束会话";
	jump choke;
}
```

### 默认模块

```assembly
do default {
	speak "相关功能暂未开发哦~";
	jump ask;
} 
```

### 询问语句

```assembly
do ask {
	speak "亲~还有什么我可以帮助您的？";
	jump choke;
}
```

### 投诉建议

```assembly
do complaint_or_suggest {
	speak "亲，请向我们阐述您详细的投诉诉求~";
	jump choke;
    set complaint = @content@;
    speak "亲，我们非常理解您的心情，我们已经收到您的投诉，您对我们有什么建议吗？";
    jump choke;
    jump ask;
}
```

### 技术帮助

```assembly
do help {
	speak "选项列表";
	jump ask;
}
```

### 修改密码

```assembly
do change_password {
	set original_password = call getOriginalPassword;
	speak "请输入原密码：";
	jump choke;
	set original_password_input = @content@;
	if (original_password_input == original_password) {
		jump input_new_password;
	}
	else {
		speak "你输入的原密码错误，请重新输入";
		jump change_password;
	}
}
```

### 输入新密码

```assembly
do input_new_password {
	speak "请输入您的新密码：";
	jump choke;
	set new_password = @content@;
	set password_judge = call judgePassword;
	if (call password_judge) {
		jump confirm_password;
	}
	else {
		speak "密码不符合规范，仅由字母+数字组成，请重新输入";
		jump input_new_password;
	}
}
```

### 确认密码

```assembly
do confirm_password {
	speak "请确认您的密码：";
	jump choke;
	set confirm_password = @content@;
	if (confirm_password == new_password) {
		speak "修改密码成功！";
		jump ask;
	}
	else {
		speak "您两次输入的密码不同，请重新输入";
           jump input_new_password;
	}
}
```

### 查询账户信息

```assembly
do query_account {
	set output = call getUserInformation;
	speak"用户:@name@\n注册时间:@time@\n余额:@money@\n";
	jump ask;
}
```

### 充值

```assembly
do recharge {
	speak "请输入您想要充值的金额:";
	jump choke;
	set recharge_money = @money@;
	set recharge_success = call Recharge;
	if (recharge_success) {
		speak "充值成功，当前余额:@money@";
		jump ask;
	}
	else {
		speak "充值失败，请稍后重试...";
		jump ask;
	}
}
```

